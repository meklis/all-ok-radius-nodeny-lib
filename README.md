## API для интеграции All-Ok-Radius в NoDeny

Аналог реализации работы free radius + процедуры mysql
http://nodeny.com.ua/wiki/index.php/Dhcp%2BRadius    

### Отличия от реализации с free radius + процедуры mysql
   *  Используется радиус https://github.com/meklis/all-ok-radius-server    
   *  Поиск IP производится с учетом тегов(имени dhcp-сервера)
   *  Возвращает имя пула в случае, если IP не был найден     
   

### Подготовка
1.  На микротике создать dhcp-сервера и соответствующие пулы для них (имя должно соответствовать имени dhcp-сервера).   
2.  На микротике, для пулов с именем dhcp-сервера запретить доступ в интернет, разрешить только заглушку или какие то локальные ресурсы.     
3.  В биллинге создаем динамические пулы (для абонентов с существующим в биллинге MAC устройства, но без закрепленного IP) с таким же названием как и DHCP-сервер.    

**Важно!**   
Биллинг при выдачи IP не проверяет дубликаты в сети, могут быть конфликты IP.   
Для того, что бы избежать конфликтов - удостоверьтесь, что пулы (диапазоны адресов для dhcp-сервера) на микротике и в биллинге(динамические ip) не пересекаются.    


### Установка и запуск 
  Вариант развертывания в docker (вместе с радиусом) - https://github.com/meklis/docker-radius-nodeny


### Обработка запросов
  1. Проверяется, есть ли полное совпадение по IP/MAC/тег. если есть - выдается IP.   
  2. Проверяется, есть ли MAC/тег(таблицы mac_uid, data0 ), производится поиск свободного IP (по динамическим IP с тегом).       
      2.1 Если IP найден - он закрепляется за абонентом и выдается.    
      2.2 Если не найден - возвращается Access Reject, пользователь не получит IP.
  3. Если IP не найден (нету мака в базе) - выдается пул по имени сервера. 


